---
layout: layouts/post.njk
---


## 母集団の標準偏差を知らないときにも推定したい

では，母分散$\sigma^2$が分からないときは，どうすればいいでしょうか．

<div class="max-xl:w-full max-xl:overflow-x-scroll">

$$ P(\overline{X} - 2\frac{\sigma}{\sqrt N} \leqq \mu^D  \leqq \overline{X} + 2\frac{\sigma}{\sqrt N}) = 0.95$$ 

</div>

としても，$\overline{X} $はサンプルから計算できますが，σは計算できないので，$\mu^D $の範囲を求めることはできません．

その場合は，$z=\frac{ \overline{X} - \mu }{\sqrt{\frac{\sigma^{2}}{N}}}$の$\sigma^2$を不偏分散$S^2$に置き換えた変数$t=\frac { \overline{X} - \mu } { \sqrt{S^2/{N} }}$が，tは自由度Nのt分布に従うことを使います．このことを，$t \sim t(N) $と表します．t分布の式は複雑なので知りたい人はwikipediaを参照ですが，理解すべきは，

- t分布$t(\nu)$はtについての関数でパラメータは$\nu $(ニュー)のみ．
- つまり，$\nu$の値が定まればt分布のグラフは一つに決まる．
- この$\nu$にサンプル数Nを代入したt(N)に$t=\frac { \overline{X} - \mu } { \sqrt{S^2/{N} }}$は従う．

ここで標準正規分布のときと同じように[このサイト](https://www.geogebra.org/m/AxtegHsz)でt分布の場合の確率について見てみてください．

![使い方の説明をgifで]()

以下の事実を確認してください．

- t分布の形は標準正規分布と似ている．
- そして自由度(今回の例ではこれはサンプル数)を大きくするほど，t分布は標準正規分布に近づく．なぜなら，
- t分布の平均μは0であり，
- 自由度を大きくするほどt分布の標準偏差σは1に近づくから．

これは当たり前のことです．なぜなら，tはzに含まれる母分散$\sigma^2$を不偏分散$S^2$に置き換えたもので，サンプル数が十分多ければ，$S^2 \fallingdotseq σ^2$だからです．

さて，Dr.Kらの実験ではサンプル数が50なので，df=50として$P(-a≦t≦a)=0.95$(標準正規分布と同様にt分布が左右対称なことから-aからaとおくことができます)となるaを調べると，a=2.01であることがわかります．そこで後は同様に，$t=\frac { \overline{X} - \mu } { \sqrt{S^2/{N} }}$を代入して，
$$
P(-2.01≦\frac { \overline{X} - \mu } { \sqrt{S^2/{N} }}≦2.01)=0.95
$$
これを変形して，
<div class="max-xl:w-[98%] max-xl:overflow-x-scroll">

$$
P(\overline{X}-2.01\sqrt{\frac{S^2}{N} }≦ \mu≦\overline{X}+2.01\sqrt{\frac{S^2}{N} })=0.95
$$

</div>
母分散が分かるときと見比べてみると，

<div class="max-xl:w-[98%] max-xl:overflow-x-scroll">

$$
P( \overline{X} -1.96\sqrt{\frac{\sigma^{2}}{N}}  \leqq \mu \leqq \overline{X} +1.96\sqrt{\frac{\sigma^{2}}{N}}) = 0.95
$$

</div>

であり，1.96だったところが，2.01に変わっています．母分散がわからない分だけ不確実性が増えていることが分かります．

あとは，サンプル平均$\overline{X}$と不偏分散$S^2$を代入するだけです．Dr.Kの薬群の場合を計算してみましょう．



では，なぜ$t=\frac { \overline{X} - \mu } { \sqrt{S^2/{N} }}$は自由度Nのt分布に従うのでしょうか．これは純粋に数学的な話で統計を理解する上では本質的ではありません．重要なのは，前回と同じように，

- サンプルを取ってくるごとに，tの値は一つに決まる．μについては私たちは知り得ないが，値は確定しているから，μを知っている神様なら各サンプルについてtの値を計算できる
- そしてサンプルをたくさん取り出してtの分布のヒストグラムを作ると，それは自由度Nのt分布という確率分布f(t)の関数と一致する．一応f(t)を載せておきますが理解する必要はありません．$\Gamma(z)$はガンマ関数と呼ばれる階乗を拡張した特殊な関数ですが，zについての関数なので，zにサンプル数を代入した$\Gamma ((\nu +1)/2)$や$\Gamma (\nu/2)$は定数です．


- 自由度ν=50のf(t)については$\int_{-2.01}^{2.01}f(t)dt = 0.95$が成り立つ．これは計算すれば分かるが計算は機械がやってくれるので，その方法を理解する必要はない．すなわち，自由度ν=50のf(t)に従うtについて，$P(-2.01≦t≦2.01)=0.95$である．
- だから，サンプルをたくさん取り出してくればサンプルの95%で，$-2.01≦t≦2.01$が成立する．このことは，tに$\frac { \overline{X} - \mu } { \sqrt{S^2/{N} }}$を代入して整理した$\overline{X}-2.01\sqrt{S^2/{N} }≦ \mu≦\overline{X}+2.01\sqrt{S^2/{N} }$についても同様で，100個サンプルがあれば，平均95個のサンプルについては，これが成り立つ．

以上を理解できれば十分です．

最後にDr.K,Dr.H,Dr.Mの結果についてもまとめたページを見てください．

## 薬の効果の推定

最後に，薬の効果の推定$μ^D-μ^P$の推定です．

まず，$ X_k \sim N(μ_1, σ_1) $であるデータ$X_1,X_2 \cdots X_m$と，$ Y_i \sim N(μ_2, σ_2) $であるようなデータ$Y_1,Y_2 \cdots Y_n$があるとき，
$$
\overline{X} - \overline{Y} \sim N(\mu_1 -\mu_2,\frac{\sigma_1^{2}}{m}+\frac{\sigma_2^{2}}{n})
$$
で，これを標準化して，
$$
\frac{(\overline{X} - \overline{Y}) - (\mu_1 -\mu_2)}{\sqrt{\frac{\sigma_1^{2}}{m}+\frac{\sigma_2^{2}}{n}}} \sim N(0,1)
$$
です．あとは，母分散$σ_1^2$と$σ_2^2$が分からないので，t分布のときのように，これをサンプルから計算できる値に置き換えます．そこでまずは，$σ^2=σ_1^2=σ_2^2$を仮定します．すなわち，二つの分散は等しいと仮定して，その等しい分散を$σ^2$と置きました．これで，
$$
\frac{(\overline{X} - \overline{Y}) - (\mu_1 -\mu_2)}{\sqrt{\sigma^{2}(\frac{1}{m}+\frac{1}{n}})} \sim N(0,1)
$$
となるので，あとは$σ^2$をプールされた分散$U_e$で置き換えます．具体的には，XとYの不偏分散を$U_X,U_Y$とおくと，
$$
U_e=\frac{(m-1)U_X+(n-1)U_Y}{m+n-2}
$$
がプールされた分散です．これで$σ^2$を置き換えると，
$$
t=\frac  { (\overline{X} - \overline{Y})  - (\mu_1 -\mu_2) } {\sqrt{U_e(\frac{1}{m}+\frac{1}{n})}}
$$
となりますが，記号で気づく通り，tはt分布に従います．そしてその自由度は(m+n-2)です．これで，$\mu_1 -\mu_2$を推定することができます．

例えばDr.Kの結果はまとめを見ると，

<div class="max-xl:w-[98%] max-xl:overflow-x-scroll ">

$\overline{X}=m^D,\overline{Y} = m^P,U_X=S_D^2,U_Y = S_P^2,m=50,n=50$

</div>

で，自由度98のt分布については，やはりこのサイトを使うと，$P(-1.99≦t≦1.99)=0.95$が分かるので，以上から

<div class="max-xl:w-[98%] max-xl:overflow-x-scroll">

$$
P( (\overline{X} - \overline{Y}) -1.99\sqrt{U_e(\frac{1}{m}+\frac{1}{n})}  \leqq \mu_1 -\mu_2 \leqq  (\overline{X} - \overline{Y}) +1.99\sqrt{U_e(\frac{1}{m}+\frac{1}{n})}) = 0.95
$$

</div>
に値を代入して整理すると，
$$
P(1.1≦\mu_1 -\mu_2 ≦4.7) = 0.95
$$
と薬の効果を推定できます．

これも，なぜプールした分散$U_e$に置き換えるとt分布になるのか，というのは純粋に数学的な話なのであまり重要ではありません．サンプルを取ってくるたびに，tの値が一つに決まって，tの分布を調べると，(数学的な理屈により)t分布になることが分かる，ということが理解できれば十分です．

https://toketarou.com/t_test/



## 意思決定だ！

より重要なのは意思決定です．Dr.HとDr.Mの結果についてもまとめたページを見てほしいですが，3人の推定では薬の効果$\mu_1 -\mu_2$の95%信頼区間は，次のようになりました．

やはり食い違いがあります．ここで，サンプルサイズが大きいほど標準誤差が小さくなることを思い出しましょう．それゆえ，3人の結果をばらばらにではなく，まとめたほうがより正確な推定ができることが考えられます．

そこで3人の結果をまとめて，300人の実験結果として薬群，プラセボ群の平均や不偏分散を求めてみます．

これを用いて，もう一度$\mu_1 -\mu_2$を計算してみると次のような結果になります．

以上をもって，薬には1cm程度身長を伸ばす効果があると判断し，薬を使うこととなりました．

おしまい．

