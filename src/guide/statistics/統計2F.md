---
layout: layouts/post.njk
---

## 前回の話の整理

前回の話を整理しましょう．まずヒストグラムのbar一本一本はp(a,b)=P(a x b)にa,bを入れた場合を視覚的に表したものなので，あらゆるヒストグラムはp(a,b)という関数で一般的に表現されました．そしてp(a,b)自体を数式で表すために，

\\[p(a,b) =  \int_{a}^{b} f(x) dx \\]

となる関数f(x)を求めることにし，身長の分布の場合には，f(x)として正規分布

\\[f(x) = \frac{1}{\sigma \sqrt{2\pi}}e^{\frac{-(x-\mu)^2}{2\sigma}} \\]

が当てはめられることを天下り的に主張しました．

## 

この主張の正当性を調査しましょう．そのためには，f(x)自体を理解しましょう．

まずf(x)の数式をみて怯える必要はありません．y=f(x)とすれば，f(x)はxを入力すると，yを返すような関数です．式をみると，μとσという余計な数が入っていますが，これはパラメータです．これについても関数のページで説明していますので詳しくはそちらを見てください．簡単に言うと，y=ax+bというxについての1次関数のパラメータがa,bであるように，μとσもxについての関数である正規分布のパラメータなのです．だから，a,bの値を決めれば1次関数の形が決まるように，μとσの値が決まれば正規分布の形が一つに決まります．

そこで，μとσをいろいろ動かして正規分布のグラフがどう変わるかを理解してください．

![μとσを動かせるiframe埋め込み]()


まずミューだけを動かすと，グラフは平行移動します．そして，ミューの値はグラフの真ん中(yの値が一番大きいxの値)と等しいことに注意します．
次にシグマだけを動かすと，シグマが大きいほど，グラフの山の幅が大きくなることが分かります．

<div><div style="position:relative;padding-top:76.25%;"><iframe scrolling="no" title="Normal Distribution" src="https://www.geogebra.org/material/iframe/id/QEayZCpM/width/817/height/566/border/888888/sfsb/true/smb/false/stb/false/stbh/false/ai/false/asb/false/sri/false/rc/false/ld/false/sdz/false/ctl/false" style="position:absolute;top:0;left:0;width:100%;height:100%;"> </iframe></div></div>

そして，正規分布のグラフ自体が，身長の分布のヒストグラムと形がよく似ていることに気づきます．

![正規分布のグラフとヒストグラム]()

形が同じになる理由を理解するために正規分布からヒストグラムを生成してみましょう．
例えばbarの幅が1であるヒストグラムを正規分布から作るためには以下のようにすればよいです．

![1刻みで正規分布を分ける,y軸の値を平均する,ヒストグラムを取り出す]()

もしくは，barの幅が2であるヒストグラムを正規分布から作るためには以下のようにすればよいです．

![2刻みで正規分布を分ける,y軸の値を平均する,ヒストグラムを取り出す]()

幅が2の場合は，高さを2倍する必要があることに注意しましょう．一般に，幅がnの場合も同様です．

![n刻みで正規分布を分ける,y軸の値を平均する,ヒストグラムを取り出す]()

そうすると，もしある分布が正規分布をしているのであれば，縦軸の倍率を別にして，ヒストグラムは正規分布と似た形になるはずです．
逆にいえば，ヒストグラムが正規分布のような形をしていることは，正規分布を当てはめる根拠になります．例えば身長の母集団の分布を見ると，これは正規分布と形がよく似ていますから，正規分布が当てはめられることの1つの根拠とできるでしょう．

では，ヒストグラムが与えられたときに実際にどんなμとσとすれば，適切な正規分布を当てはめたことになるのでしょうか．例として以下の集団PPPのヒストグラムに正規分布を当てはめてみてください．

<iframe src="" frameborder="0"></iframe>

わざとらしく，PPPの平均と標準偏差が書いてあることに気づきましたか？当てはめていくと，μの値がPPPの平均に一致して，σの値がPPPの標準偏差と一致するときに，ヒストグラムと正規分布の適合度が良くなることが分かります．一般的に主張したいのは次のことです．

ある集団のある性質の分布に正規分布が当てはめられるなら，その性質の平均，標準偏差をμ,σとした正規分布を当てはめればよい．

これを説明しましょう．そのためには平均とは何かを理解する必要があります．例としてサイコロを6万回投げたときに出る目の平均を考えてみます．実際のデータは次のようになりました．(データが多いので最初の100個だけを抜き出しています．)

[markdownで表す]

k回目に出た目をX_kとすれば平均は

math:sigmaで表現

と求められます．これを相加平均と呼びましょう．しかし，こんなたくさん計算しなくても6万回も投げれば，それぞれの目は1万回ずつぐらい出ているはずなので，

math:確率で表現

とすれば良いでしょう．これはサイコロの目の分布を使って計算することと同じです．これを確率平均と呼びます．

![サイコロの目の分布]()

身長の分布のヒストグラムもサイコロの目の分布と同じものだと考えられます．つまりサイコロを一回投げればこの確率で各目が出てきますし，集団からランダムサンプリングして身長を測れば，それぞれの身長はヒストグラムで与えられた確率で出てきます．(違いは，サイコロは飛び飛びの(離散的な)値ですが，身長は連続的な値だということです．)

であれば，身長についても，相加平均ではなく，確率平均からも求められます．値としては簡単のために一番小さい値を代表させることにしましょう．

この2つは一般的には一致しません．しかし，ヒストグラムの幅を小さくしていけば，相加平均と確率平均は一致します．これは集団の要素数が少ない場合で考えると分かりやすいでしょう．

以上が必要な前提知識です．では仮に，あるヒストグラムと正規分布が完全に重なっているとしましょう，そしてヒストグラムの幅は十分に小さいとします(縦軸の倍率はうまく調整)．このとき，母集団の相加平均は確率平均と十分近くなっていますが，確率平均は極限を取ると


と一致します．ゆえに

母集団の平均=　

が示せます．あとはこの積分を計算すると，μになります．

極限を取ると，積分に一致するというところを区分求積法のイメージで説明すると次のような図になります．

![区分求積法を使った説明]()

あとは，母集団の分散も同様の理屈で，確率を使って表すことができます．これを変形して，

ゆえに，

母集団の分散=　


以上から，主張を示すことができました．ここまでの作業で母集団の分布を恣意的なヒストグラムで表すことをやめて，母集団の平均・分散で1つに決定される正規分布という式で表すことができるようになりました．ここまでできれば，揺らぎの問題に立ち向かう準備ができています．

まず，[平均の定義](https://www.kwansei.ac.jp/hs/z90010/sugakuc/toukei/avgvar/avgvar.htm)と，区分求積法を使って説明．https://univ-juken.com/kubun-kyusekihou の図を使う．区分求積法自体は[このサイト](https://hiraocafe.com/note/kubunkyuseki.html)や[youtubeの動画](https://www.youtube.com/watch?v=x-xeLzH5SUw)で理解してもらう．