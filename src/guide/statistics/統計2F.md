---
layout: layouts/post.njk
---

## 前回の話の整理

前回の話を整理しましょう．まずヒストグラムはa≦x≦bとなる確率\\( P(a \leqq x \leqq b ) \\)に具体的なa,bをいくつか代入した値を視覚的に表したものでした．

![barwidth=4の場合でヒストグラムが表していることを説明](/img/stats/barwidth=4の場合でヒストグラムが表していることを説明.png){.py-6}

そこで，\\( p(a,b) = P(a \leqq x \leqq b ) \\)を満たす関数は，あらゆるヒストグラムの情報を集約することができるのでした．そして\\( p(a,b) \\)自体を数式で表すために，

\\[p(a,b) =  \int_{a}^{b} f(x) dx \\]

となる関数f(x)を定めることにし，身長の分布の場合には，f(x)として正規分布

\\[f(x) = \frac{1}{\sigma \sqrt{2\pi}}e^{\frac{-(x-\mu)^2}{2\sigma}} \\]

が当てはめられることを天下り的に主張しました．

この主張の正当性を調査しましょう．そのためには，まずf(x)の性質を理解します．y=f(x)として，ここでは次のことが分かれば十分です．

- y=f(x)はxについての関数である．つまり，xを入力すると，yを返す．
- f(x)の式には，μとσというパラメータが含まれる．これは，y=ax+bというxについての1次関数にパラメータがa,bが含まれることと同様
- よって，μとσに具体的な数を代入すれば，正規分布y=f(x)のグラフの形が一つに決まる．

これらについても関数のページで説明していますので詳しくはそちらを見てください．

以上を理解した上で，[ここ](https://www.geogebra.org/calculator/gcbzwrgx)でμとσをいろいろ動かして正規分布のグラフがどう変わるかを見てみましょう．

理解してもらいたいのは次の2つです．

- μだけを動かすと，グラフは平行移動する．
- μの値はグラフの真ん中(yの値が一番大きいxの値)と等しい．
- σだけを動かすと，σが大きいほど，グラフの山の幅が大きくなる．

さらに[ここ](https://www.geogebra.org/calculator/mcpyfvzj)で「σとグラフの山の幅」の関係を定量的に理解します．具体的には，次のことを抑えましょう．

- σの値がいくつであっても，x=μ±3σまでにyの値はゼロに近づく

さて，グラフを動かしていると，正規分布のグラフ自体が，身長の分布のヒストグラムと似た形をしていることに気づきます．{.pt-4}

![正規分布のグラフとヒストグラム](/img/stats/正規分布とヒストグラムの類似性.png){.py-6}

形が同じになる理由を理解するために正規分布からヒストグラムを生成してみましょう．前提として次のことをおさえましょう．

![](/img/stats/ヒストグラムの1つのビンが示すこと.png){.py-6}
![](/img/stats/n=8の場合.png){.py-6}

つまり，1つ1つのビンの横幅がnで，高さがp(a,a+n)であれば，それは幅nのヒストグラムになっているということです．このことを用いて，例えば階級の幅が1であるヒストグラムを正規分布から作るためには以下のようにします．

![1刻みで正規分布を分ける,y軸の値を平均する,ヒストグラムを取り出す](/img/stats/幅が1の場合のヒストグラムの作り方.png){.py-6}

もしくは，barの幅が2であるヒストグラムを正規分布から作るためには以下のようにします．

![2刻みで正規分布を分ける,y軸の値を平均する,ヒストグラムを取り出す](/img/stats/幅が2の場合のヒストグラムの作り方.png){.py-6}

幅が2の場合は，高さを2倍する必要があることに注意しましょう．一般に，幅がnの場合も同様です．

![n刻みで正規分布を分ける,y軸の値を平均する,ヒストグラムを取り出す](/img/stats/幅がnの場合のヒストグラムの作り方.png){.py-6}

以上から，もしある分布が正規分布をしているのであれば，縦軸の倍率を別にして，ヒストグラムは正規分布と似た形になることが分かります．逆に，ヒストグラムが正規分布のような形をしていることは，正規分布を当てはめる根拠になります．

例えば身長の母集団の分布を見ると，これは正規分布と形がよく似ていますから，正規分布が当てはめられることの1つの根拠とできるでしょう．

![](/img/stats/母集団の結果.png){.py-6}

<div class="text-sm leading-5">実際には母集団の分布を知ることはできないので，サンプルの分布を正規分布に当てはめられるかを考えます．また，データの生成プロセスについての情報からも正規分布を当てはめられることが分かることもあります．これについては後ほどやりましょう．</div>

正規分布が当てはめられることが分かれば，次の問題はμとσの値をどうするか，ということです．[ここ](https://www.geogebra.org/classic/xvtg7q4h)で実際にデータに当てはまるμとσを動かして見つけてみましょう．{.pb-10}

わざとらしく，データの平均と標準偏差が書いてあることに気づきましたか？いろいろと動かしてみると，

- μ=データの平均
- σ=データの標準偏差

となるときに，ヒストグラムと正規分布の適合度が良くなることが分かります．一般的に主張したいのは次のことです．

<div class="border-l-8 border-blue-700 bg-blue-100 py-2 px-4 rounded my-8">
<div class="leading-[34px]">集団のある性質の分布に正規分布が当てはめられるなら，μにその性質の平均，σに標準偏差を代入した正規分布を当てはめればよい．
</div></div>

この章の残りの部分では，これが成り立つことを説明していきますが，完全に理解するためには区分求積法の考え方を理解している必要があります．この説明を理解することは，統計を学習する上で本質的なものではないので，難しい話に興味がない人や，μ，σをヒストグラムに当てはめる先程の実験で上の主張を受け入れられるよ，という人は先に進んでください．

<div class="text-sm leading-5 pt-2 pb-8">

区分求積法の考え方は，高度な計算を要するものではなく，積分という概念についてのものなので，それほど事前知識がなくとも理解できます．[このサイト](https://hiraocafe.com/note/kubunkyuseki.html)で区間が0-1の場合を，[このサイト](https://univ-juken.com/kubun-kyusekihou)で区間がa-bの場合を理解しましょう．また，[このyoutubeの動画](https://www.youtube.com/watch?v=x-xeLzH5SUw)で和と積分の関係が理解できると思います．

</div>

ではやっていきましょう．まず，平均とは何かを理解します．例としてサイコロを100回投げたときに出る目の平均を考えます．実際のデータは次のようになりました．

<div style="height : 400px" class="overflow-y-scroll my-8">

|回目|サイコロの目|
|---|---|
|1|3|
|2|1|
|3|1|
|4|2|
|5|5|
|6|6|
|7|2|
|8|6|
|9|5|
|10|5|
|11|3|
|12|1|
|13|3|
|14|4|
|15|4|
|16|6|
|17|4|
|18|6|
|19|3|
|20|6|
|21|1|
|22|2|
|23|5|
|24|4|
|25|3|
|26|4|
|27|1|
|28|5|
|29|3|
|30|2|
|31|2|
|32|4|
|33|3|
|34|4|
|35|2|
|36|5|
|37|2|
|38|5|
|39|4|
|40|5|
|41|6|
|42|2|
|43|5|
|44|4|
|45|1|
|46|3|
|47|2|
|48|1|
|49|4|
|50|4|
|51|6|
|52|6|
|53|5|
|54|3|
|55|3|
|56|5|
|57|5|
|58|4|
|59|4|
|60|6|
|61|5|
|62|1|
|63|1|
|64|4|
|65|5|
|66|2|
|67|6|
|68|1|
|69|6|
|70|6|
|71|4|
|72|4|
|73|2|
|74|1|
|75|3|
|76|5|
|77|5|
|78|3|
|79|3|
|80|6|
|81|3|
|82|1|
|83|5|
|84|5|
|85|6|
|86|2|
|87|4|
|88|3|
|89|1|
|90|4|
|91|2|
|92|4|
|93|1|
|94|5|
|95|2|
|96|3|
|97|4|
|98|3|
|99|5|
|100|4|

</div>

k回目に出た目を\\( X_k \\)とすれば平均mは

\\( m = \displaystyle \frac{1}{100}\sum_{k=1}^{100} X_k = 3.61\\) 

と求めることができます．これを相加平均と呼びましょう．ここで，1~6の目が出た回数でデータを整理してみます．

<div class="my-12">

|目|でた回数|でた割合|
|---|---|---|
|1|14|0.14|
|2|14|0.14|
|3|17|0.17|
|4|21|0.21|
|5|20|0.20|
|6|14|0.14|

</div>

こうすれば，平均は，

\\(m = \frac {1 \cdot 14 + 2 \cdot 14 + 3 \cdot 17 + 4 \cdot 21 + 5 \cdot 20 + 6 \cdot 14}{100} = 3.61\\)

と求めることもできます．各項を分母の100で割ると，

\\(m = 1 \cdot 0.14 + 2 \cdot 0.14 + 3 \cdot 0.17 +  \\\\ 4 \cdot 0.21 + 5 \cdot 0.20 + 6 \cdot 0.14 = 3.61\\)

すなわち，サイコロの目\\( k \\)がでた割合を\\( p_k \\)すると，

\\( m = \displaystyle \sum_{k=1}^{6} k \cdot p_k\\) 

で平均が計算できるわけです．これを割合平均と呼びましょう．<small>(この呼び方は一般的な呼び方ではなく，ここでの説明のための呼び方です)</small>

![サイコロの目の分布](/img/stats/サイコロの目のヒストグラム.png){.py-8}

このようにヒストグラムにすれば，サイコロの目の分布は，身長の分布と似たものに見えます．違いは，身長は実数という**連続的**な値をとるのに対して，サイコロの目は1~6の整数，つまり飛び飛びの値(これを**離散的**といいます)しか取らないことです．

それゆえ，サイコロの場合は，このようにヒストグラムをかけば，それはサイコロの目の完全な分布と一致します．なぜなら，サイコロの目の取りうる値は有限個(1~6の6つ)で，ヒストグラムは全ての場合についてのP(x=k)<small>(サイコロの目xがkになる確率=割合)</small>を列挙してグラフ化できるからですす．別の言い方をすれば，サイコロの目の分布は上記のヒストグラム以外に別の書き方がありません．一方，身長の分布はビンの幅を変えたり，区切りの位置を変えたりして色々なヒストグラムを書くことができます．

このことから，サイコロの場合には，やってみたようにヒストグラムで表される割合平均で求めた平均が相加平均と一致します．一方，身長のように連続的な値の分布の場合にはヒストグラムから分かる割合平均で平均を求めようとしても，一つのビンが表す確率は，特定の値となる確率ではなくある範囲となる確率なので，うまくいきません．

![上の文について図で説明](/img/stats/身長のヒストグラムから平均を計算する.png)

問題は，ビンの幅が大きいことによるので，幅を小さくしていけば，割合平均は相加平均に近づいていきます．では仮に，幅Δx(<<1)のヒストグラムに対して，良いμ，σを選んで，正規分布をうまく当てはめられたとしましょう．このときヒストグラムの高さを正規分布と合わせるためには，各ビンの高さを1/Δx倍にする必要があることに注意してください．

![](/img/stats/1-n倍すれば高さが合うこと.png){.py-8}

当てはめのイメージとして次の図も参照してください．

<div class="py-8">
<img src="http://univ-juken.com/wp-content/uploads/2020/05/kubun-kyuseki-zukei2.png"></img>
<small>

[このサイト](https://univ-juken.com/kubun-kyusekihou)から引用しました．
</small>
</div>

当てはめた1つのビンに注目すると次のようになっています．

![](/img/stats/一つのビンに注目した場合.png){.py-8}

ゆえに

\\( m = \displaystyle \sum_{k=0}^{n} x_k \cdot p(x_k,x_{k+1}) = \displaystyle \sum_{k=0}^{n} x_k \cdot f(x_k) \cdot \Delta{x}\\) 

が示せます．あとは\\(\lim_{ \Delta{x} \to 0} \\)とすると，

\\( \lim_{ \Delta{x} \to 0} \displaystyle \sum_{k=0}^{n} x_k \cdot f(x_k) \cdot \Delta{x} = \int_{-\infty}^{+\infty} xf(x) dx \\) 

ゆえに，

\\[ m = \int_{-\infty}^{+\infty} xf(x) dx \\]

が示せました．さて，f(x)が正規分布，すなわち，

\\[f(x) = \frac{1}{\sigma \sqrt{2\pi}}e^{\frac{-(x-\mu)^2}{2\sigma}} \\]

のときは，

\\[\int_{-\infty}^{+\infty} xf(x) dx = \mu \\]

であることが知られています．<small>(証明は[このサイト](https://ai-trend.jp/basic-study/normal-distribution/n-parameter-derivation/)を参照．単なる計算なのでスキップ可です．)</small>

分散についても同様で，データの分散を\\(s^2\\)とすると，

\\[ s^2 = \sum_{k=0}^{n} (x_k - \mu)^2 p_k \\]

より，

\\[ s^2 = \sum_{k=0}^{n} (x_k^2 -2x_k\mu +\mu^2) \cdot p_k \\]

で，平均のときと同様に考えると，

\\[ s^2 = \int_{-\infty}^{+\infty} (x^2f(x) -2\mu xf(x) +\mu^2f(x)) dx\\]

となり，ここで，

\\(\int_{-\infty}^{+\infty} x^2f(x)dx = \sigma^2 + \mu^2 \\)
\\(\int_{-\infty}^{+\infty} xf(x) dx = \mu \\)

であることを使うと，<small>(証明は[このサイト](https://ai-trend.jp/basic-study/normal-distribution/n-parameter-derivation/)を参照．単なる計算なのでスキップ可です．)</small>

\\[ s^2 = \sigma^2 + \mu^2 -2\mu^2 + \mu^2 = \sigma^2\\]

となります．以上から，主張を示すことができました．ここまでの作業で母集団の分布は恣意的なヒストグラムではなく，母集団の平均・分散で1つに決定される正規分布という式で表すことができるようになりました．これで，揺らぎの問題に立ち向かう準備ができました．