---
layout: layouts/post.njk
---

## ランダムサンプリングにより二つの困難を解消する

さて，2集団が同一であるとは，2集団のあらゆる性質の分布が等しいこと，と定義しました．では，実際にあらゆる性質，私たちが知ることのできる性質も，知り得ない性質も全てが等しいような2集団はどうやって作るのでしょうか．

<div class="text-sm leading-[22px] my-4">逆に，もし2集団の分布が何かしらの点で異なる場合，例えば，身長の伸びを促進する遺伝子Gの分布が異なっていれば，薬に対する効果と思っていたものは，実はこの遺伝子Gの分布の差に起因していたことがありえ，集団の平均効果の差が薬の効果とはいえなくなります．つまり「薬の効果といっているけど，薬を使った群は，遺伝子Gをたくさんもっている人が多いのだから，これが薬群の身長の伸びが良かった原因で，薬の効果が原因ではないかもしれないよね？」などと反論される可能性があります．</div>

その方法が<stbl>ランダムサンプリング</stbl>です．

<div class="border-l-8 border-blue-700 bg-blue-100 py-2 px-4 rounded my-8">
<div class="leading-[34px]"><b>ランダムサンプリング</b>とは，集団からその構成員をランダムに選ぶ<small>(サンプリングする)</small>こと．
</div></div>

例えばある1万人の5歳0日児を集めた集団Qの身長の分布は次のとおりでした．

集団Qの身長分布
![集団Qの身長データ](/img/stats/集団Qの身長分布.png)

この集団Qからランダムサンプリングにより100人を選んで集団Rを作ると，QとRのすべての性質の分布は同じになります．つまり，QとRは同一の集団になるのです．

このことを，まずはQとRの身長の分布が等しいことから説明しましょう．Qからランダムサンプリングするとき，例えば104-105cmの人がでる確率は0.08=8%になります，であれば，100人サンプリングすると，104-105cmの人は平均して\\(0.08 \cdot 100 = 8\\)人となり，これを全体の人数100で割って割合にすれば，0.08となってQと一致します．他の身長についても同じ理屈でQとRの割合は同じになります．よって，身長の分布が一致します．

身長以外の要素についても，同じ理屈を使うと分布が一致することが分かります．

集団Qの他の要素の分布
![QとRの他の要素の分布](/img/stats/QとRの他の要素の分布.png)

よって，私たちが知り得るものであれ，知り得ないものであれ，すべての性質の分布が同一になることが分かります．

![かんぜんな実験の図](/img/stats/5人の子供の集団ver.png)

であれば，ステップ2の複製は必要ありません．そのかわりに，

1. 元の集団からランダムサンプリングして半分を抜き出す
2. 残った集団を薬群に，抜き出した集団をプラセボ群にする．

こうすることで，元の集団と同一の集団を2つ作って，薬群とプラセボ群に分けることができます．これは，集団の構成員1人1人に1/2の確率で(つまりランダムに)薬を飲むのかプラセボを飲むのかを割り当てても同じことなので，ランダム割当とも呼ばれます．

![ランダム割当](/img/stats/ランダム割当.png)

こうして考えると，もう１つの困難「母集団を集めることができない」も解消されることが分かります．そもそも，母集団を集めるのは，母集団への薬の効果を調べたかったからでした．そこで，良いサンプル，つまり，母集団への薬の効果とサンプルへの薬の効果が同じと見なせるようなサンプルを作ろうとしていました．これは母集団と同一の集団を作ることで解決されます．つまり，母集団からランダムサンプリングによってサンプルを作ればよいわけです．これは，実験の対象となるサンプルを母集団からランダムに選んでくるという意味でランダム抽出とも呼ばれます．

<img src="/img/stats/ランダム抽出.png" alt="ランダム抽出" width="350px">

こうして2つの困難は次のように解決されます．

1. 母集団を集めること 👉👉👉 母集団からランダムサンプリングでサンプルを作る(ランダム抽出)
2. 母集団を構成する1人1人を複製すること 👉👉👉 ランダムサンプリングで集団を2分割する(ランダム割当)

これをまとめると次のようになります．

![実際の実験手順](/img/stats/実際の実験手順.png)

すなわち，薬の効果は母集団の差\\(\mu^D - \mu^P\\)で求められますが，これと同じ分布をもつサンプルの差\\(m^D - m^P\\)で薬の効果を求めても一致するだろう，ということです．小さな?マークが付いている箇所は，後で正確でないことが分かる部分です．しかし概要の考え方の方向性としては間違っていませんので今は気にせず進みましょう．

ランダム抽出もランダム割当もランダムサンプリングが文脈に応じて呼び名を変えたものであり，本質的にやっていることに違いはないことは忘れないでください．

<small>5歳児の例では，実際に母集団からランダムサンプリングすることは難しいでしょう．Dr.Kが集められるのは，近い将来に5歳になる子供達のみです．しかし，ランダムサンプリングの本質な目的は分布を同一にすることにあることを考えると，結果として分布が同じになっていればそれで十分なわけです．つまり，現在うまれる子供と将来うまれる子供の遺伝的・生活的な差がない=あらゆる性質について分布が同じになる，ということが合理的な仮定と見なせるなら，ランダムサンプリングでなくても，現在の子供達は母集団と同一のよいサンプルと見なせるわけです．この仮定は十分合理的として話を進めましょう．</small>

## サンプルは揺らぐ

Dr.Kは以上の理屈から，次のような実験を行い，結果を得ました．

1. ここ1週間でJ国で5歳になる100人の子供を集める．
2. 100人の子供をランダムサンプリングによって，50人ずつの2集団に分割し，薬群，コントロール群に分ける．
3. 2群の6歳0日時の身長の平均の差+2.9cmを薬の効果とする．

![Dr.Kの実験結果](/img/stats/Dr.Kの実験結果.png)
<div class="hidden">この100人が母集団からのランダムサンプリングと見なせると考えて，このサンプルから求めた平均差が薬の効果だとDr.Kは考え，これを学会で報告しました．</div>

Dr.Kはこの結果を学会で発表しましたが，この報告を聞いたDr.Hは，この結果を確かめるために全く同じ方法で追加実験を行いました．その結果，薬の効果は+1.1cmでした．これはDr.Kの報告よりも薬の効果が低いことを表しています．

![Dr.Hの実験](/img/stats/Dr.Hの実験結果.png)

また，Dr.Kの圧倒的後押しで，薬ZはすでにJ国の子供達へ使われ始めていたのですが，実際の使用感からも，薬の効果は最初思われていたよりも高くないことが疑われ始めていました．こうして，懐疑論者Dr.Mは，さらなる追加実験を行いました．その結果は，-0.4cmと，プラセボ群のほうが身長が高くなるというものでした．

![Dr.Mの実験](/img/stats/Dr.Mの実験結果.png)

なぜ，このようなことが起きるのでしょうか．理屈では，サンプルと母集団は同一=あらゆる性質の分布が等しいので，サンプルの結果と母集団の結果は一致するはずでした．ですから本来，サンプル同士の結果も一致するはずなのです．<small>(そしてその一致した値が母集団の値と等しくなっているわけです)</small>

しかし，これは<stbl>平均的に期待できる話</stbl>なのです．もういちど，ランダムサンプリングで同一の分布になるという理屈を見てみます．

![集団Qの分布](/img/stats/集団Qの身長分布.png)

集団Qから100人をランダムサンプリングしたときに，例えば104cm-105cmになる人は**平均して**8人サンプルされる，というのが，分布が同じになることの根本的な根拠でした．しかし，これは平均的な話で，実際にQから100人ランダムサンプリングしたときの結果を幾つか見てみます．<small>(先程はあえて集団Rの実際の分布は隠していました)</small>

<div class="overflow-y-scroll h-96" style="height: 500px;">
<img src="/img/stats/sample1fromQ.png" alt="" srcset="">
<img src="/img/stats/sample2fromQ.png" alt="" srcset="">
<img src="/img/stats/sample3fromQ.png" alt="" srcset="">
<img src="/img/stats/sample4fromQ.png" alt="" srcset="">
<img src="/img/stats/sample5fromQ.png" alt="" srcset="">
</div>

こうしてみると，各々のサンプルの104cm-105cmの値はサンプルによって，5%~13%まであり，Qとは微妙にずれています．
全体の分布についても同様のことが言え，各々のサンプルとQは似たような形をしていますが，全く同じ分布とはいえません．

このように，各サンプルには「揺らぎ(サンプルごとの変動，偶然誤差)」が存在します．この揺らぎによって，Dr.K,H,Mの3者の結果が違ってしまったのです．つまり，

1. 揺らぎゆえに，母集団とサンプルの実際の分布は一致しない<small>(平均的には一致する)</small>
2. それゆえ，平均も一致しない．
3. それゆえ，薬の効果も一致しない．

という流れで，平均的には同じ分布であっても，実際にできる分布は違ってしまい，そこから計算される薬の効果もサンプルごとにばらついてしまったのです．

では，本当の薬の効果は幾つなのでしょうか．これは母集団を対象にした実験を行わなければ分かりませんが，神様にお願いして，母集団での実験結果を得られたとしましょう．

![母集団での実験結果](/img/stats/母集団の結果.png)

ちなみにDr.K,Dr.H,Dr.Mの結果の分布も見てみましょう．

<div class="overflow-y-scroll h-96" style="height: 700px;">
Dr.Kの結果
<img src="/img/stats/Dr.Kの分布.png" alt="" srcset="">
Dr.Hの結果
<img src="/img/stats/Dr.Hの分布.png" alt="" srcset="">
Dr.Mの結果
<img src="/img/stats/Dr.Mの分布.png" alt="" srcset="">
</div>

これを見ると，本当の効果に近いのはDr.Hの結果だということが分かります．しかし，現実には母集団の結果を知ることはできないので，この方法で正しい結果はどれかを判定することはできません．(そもそも母集団の結果が分かるならサンプルで実験する必要はありません)

こうして私たちの意思決定は阻まれてしまいます．3つの対立する結果があって，このままではどの結果を信頼していいのかを現実的に知ることができないからです．このサンプルの揺らぎ問題にどう対応するかが次のテーマになります．

## 一つの図にして理解する

これまでの話を1枚の図にまとめました．この図の意味するところが分かれば，これまでの内容についてはオーケーです．次に進みましょう．

![1枚でRCTの概要まとめ](/img/stats/1枚でRCTの概要まとめ.png)



<div class="hidden">
例えば，このような分布をする母集団からランダムに50個取り出して，分布をいくつか作ってみると，このようになります．だいたい同じ形をしていますが，細かく見ると実際にできた分布はバラバラです．つまり，同じ分布から生成されても，揺らぎのせいで実際にできる分布はそれぞれのサンプルで違うということです．しかし，私たちに観測できるのはサンプルだけですから，実際には，母集団とサンプルを見比べて，形が似ているとか違うとか考えることはできません．サンプルの分布から母集団の分布を推測することになります．

この揺らぎは直観的にも分かるように，サンプル数を少なくすれば多大に，サンプル数を多くすれば少なくなっていきます．

![サンプル少ない場合はn=3とn=10とか2つ用意 多い場合はほとんど違いが見えないくらいまで増やす 平均も載せる]()

ということは400人を集めたDr.Hのデータの方が信用できそうですが，では「どれだけ信用できるのか」つまり「400人のデータから求めた薬の効果は母集団から求める薬の効果と比べて，どれだけゆらぎがあるのか」という問いに対して定量的に，つまり揺らぎは2.1ですとか，1,3ですのように数値で答えるための方法論を私たちは，まだ理解していません．そもそも「揺らぎ」とは何かも定義していません．このように有限の揺らぐサンプルから，母集団をいかに定量的に推定するのか，これが次の課題になります．

1.のステップのランダムサンプリングはランダム抽出，2.のステップのランダムサンプリングはランダム割当と呼んで区別することが多いです．それぞれの名前の由来は，1のステップでは実際に実験の対象となるサンプルを母集団からランダムに選んでくるという意味でランダム抽出，2のステップでは介入か非介入かをサンプルのそれぞれにランダムに割り当てていくという意味でランダム割当という言葉が使われます．
</div>

