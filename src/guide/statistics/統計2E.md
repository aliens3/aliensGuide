---
layout: layouts/post.njk
---
# barwidth=4の場合でヒストグラムが表していることを説明.pngでヒストグラムが表す情報を追加 ヒストグラムと関数pの対応.pngのグラフと合わせて表示の画像を追加


## 問題点の確認

前回の問題点を確認します．

1. 揺らぎゆえに，母集団とサンプルの分布は一致しない
2. それゆえ，平均も一致しない．
3. それゆえ，薬の効果も一致しない．

これらの問題の根本は1.にあることが分かります．そこで，この問題1を詳しく分析しましょう．

問題1を考えるときに私たちが行っていたのは，サンプルのヒストグラムと母集団のヒストグラムを比べることです．

![ヒストグラムを比べる](/img/stats/ヒストグラムを比べる.png)

しかし，そもそもヒストグラムの表し方には恣意性があります．つまり，階級の幅や区切りの付け方をどうするのかという問題です．例えば，集団Qの分布は一つ一つのビンの幅を1にして表していましたが，これを幅を4,7,16,32とした場合と比べてみましょう．

<div class="overflow-y-scroll h-96 py-6 my-4" style="height: 450px;">
幅が1の場合<small>(前のグラフと違って見えるかもしれませんが縦軸を全てのグラフで揃えるために変えているからです)</small>
<img src="/img/stats/集団Qの分布-binwidth=1.png" alt="" srcset="">
幅が4の場合
<img src="/img/stats/集団Qの分布-binwidth=4.png" alt="" srcset="">
幅が8の場合
<img src="/img/stats/集団Qの分布-binwidth=8.png" alt="" srcset="">
幅が16の場合
<img src="/img/stats/集団Qの分布-binwidth=16.png" alt="" srcset="">
幅が32の場合
<img src="/img/stats/集団Qの分布-binwidth=32.png" alt="" srcset="">
</div>

幅を大きくするごとに，1つのビンに当てはまるデータの数は多くなり，幅を32にすれば，全てのデータが収まるので，割合は1になります．サンプルの場合でも見てみましょう．

<div class="overflow-y-scroll h-96 py-6 my-4" style="height: 450px;">
幅が1の場合
<img src="/img/stats/サンプルの分布-binwidth=1.png" alt="" srcset="">
幅が4の場合
<img src="/img/stats/サンプルの分布-binwidth=4.png" alt="" srcset="">
幅が8の場合
<img src="/img/stats/サンプルの分布-binwidth=8.png" alt="" srcset="">
幅が16の場合
<img src="/img/stats/サンプルの分布-binwidth=16.png" alt="" srcset="">
幅が32の場合
<img src="/img/stats/サンプルの分布-binwidth=32.png" alt="" srcset="">
</div>

こうしてみると，幅が1のときよりも幅が8のときのほうが，集団Qとサンプルの分布は似ているように見えます．

幅が1の場合の集団Q(上)とサンプル(下)の分布
<img src="/img/stats/集団Qの分布-binwidth=1.png" alt="" srcset="">
<img src="/img/stats/サンプルの分布-binwidth=1.png" alt="" srcset="">

幅が8の場合の集団Q(上)とサンプル(下)の分布
<img src="/img/stats/集団Qの分布-binwidth=8.png" alt="" srcset="">
<img src="/img/stats/サンプルの分布-binwidth=8.png" alt="" srcset="">

このように，母集団のヒストグラムが正解の形で，サンプルの分布がそれに近いのかを考える，という考え方は実は怪しい基盤の上に立っています．これでは揺らぎ問題に立ち向かうことはできません．

極端な話，階級の幅を∞にすれば全ての分布は完全に一致します．

![幅を∞にした場合すべての分布は一致する](/img/stats/幅を∞にした場合すべての分布は一致する.png)

では，階級の幅をできるだけ細かくすればいいのでしょうか．実際のサンプルでこれをやると，幅を小さくしたほうがむしろデータの読み取りができなくなります．

サンプル
<div class="overflow-y-scroll h-96 my-6 py-4" style="height: 450px;">
幅が1の場合
<img src="/img/stats/サンプルの分布-binwidth=1.png" alt="" srcset="">
幅が0.1の場合
<img src="/img/stats/サンプルの分布-binwidth=0.1.png" alt="" srcset="">
幅が0.01の場合
<img src="/img/stats/サンプルの分布-binwidth=0.01.png" alt="" srcset="">
</div>

では，丁度いい幅はなにか？を考えたくなりますが，もっと別の角度から攻めてみることにしましょう．**ヒストグラムを一般化する**のです．

例えば先ほどの階級幅を8にした場合をもう一度見てみると，ヒストグラムの一つ一つのビン(縦棒)が表していることは次のようなことです．そして，このヒストグラムが表す情報はこの4つの式全部です．

![barwidth=4の場合でヒストグラムが表していることを説明](/img/stats/barwidth=4の場合でヒストグラムが表していることを説明.png){.py-6}

<div class="leading-5 text-sm">例えばP(90≦x≦98)=0.024は身長xが90cm以上98cm以下である割合が0.024(2.4%)であることを示しています．</div>

他の階級幅の場合でも同様で，例えば幅1のヒストグラムが表す情報は，

・・・
\\( P(90 \leqq x \leqq 91) \\) = 〇〇
\\( P(91 \leqq x \leqq 92) \\) =　〇〇
・・・
\\( P(124 \leqq x \leqq 125) \\) = 〇〇
・・・

となるでしょう．

<div class="text-sm leading-5">
一般的にはヒストグラムの区切り位置をstart(上の図ではstart=90)，ビンの幅をbinwidth(上の図では=8)としたときに，小さい方からk番目のビンが表していることは\( P(start + binwidth \cdot k \leqq x \leqq start + binwidth \cdot (k+1) ) \)です．
</div>

つまり，一般的にはヒストグラムのビン一本一本が表していることは，その集団で\\( a \leqq x \leqq b \\)であるxの割合(もしくは，ランダムサンプリングしたときに，\\( a \leqq x \leqq b \\)となるxがでてくる確率)

\\( P(a \leqq x \leqq b ) \\)

であることが分かります．これで階級の幅を∞にすると全ての分布が等しくなる，といういかがわしい主張に反論できます．

![いろいろな集団のヒストグラム，幅を無限にしたバージョンに対して反論](/img/stats/「幅を∞にした場合すべての分布は一致する」への反論.png)

![ヒストグラムでは分布は表せない](/img/stats/ヒストグラムでは分布は表せない.png)

つまり，分布とは，すべてのa,bについての\\( P(a \leqq x \leqq b ) \\)の情報の集まりのことなので，どんなヒストグラムを書いても，分布を完全に表現することはできないのです．そこで分布をヒストグラムで表すかわりに，

\\( p(a,b) =  P(a \leqq x \leqq b ) \\) 

となる，関数p(a,b)で表すことにすれば，階級の幅や区切りの位置などの恣意性がなくなります．関数とはなにかについてはこちらにまとめたので，以降の記述が分からなくなったときは参照してください．

関数p(a,b)で表すということは，実数a,b(a≦b)をpに入力すると，xがa≦x≦bとなる確率を返してくれるということです．ヒストグラムのビン一本一本の縦軸の値は具体的なa,bを代入した時のp(a,b)の値であると解釈できます．

![ヒストグラムと関数pの対応](/img/stats/ヒストグラムと関数pの対応.png)

神様であれば，a,bの値が与えられたとき，母集団の中から，a≦x≦bとなるものをすべて集めてきて，それを母集団の要素の数で割れば，どんなa,bについてもp(a,b)を求められます．つまり，

\\( p(a,b) = \frac {a \leqq x \leqq b となるxの数} {母集団の要素数} \\) 

とするのです．しかし，この方法でp(a,b)を求めることには2つ欠点があります．

1. 母集団を知り得ない私たちは，この方法でp(a,b)は求められないこと．
2. 仮にこの方法が実行できても，これではいろいろな集団の分布の共通性・関係性を認識できないこと．

2点目が本質的に重要な問題です．例えば，薬軍とプラセボ群の母集団の分布をもう一度見ると，2つの分布の形は同じで平行移動した関係のように見えます．

![母集団の結果](/img/stats/母集団の結果.png)

しかし，

\\( p(a,b) = \frac {a \leqq x \leqq b となるxの数} {母集団の要素数} \\) 

と定義すると，形とか平衡移動のような概念が含まれないので，これらの関係を表現することはできません．

世の中には，これらと同じような形をする分布はとても多いので，統一的に扱えないのは大きな欠点です．

子供の出生体重
![子供の出生体重](https://www.hokende.com/_images/fef26a38-fce0-4715-8ebb-8aed69e024b4/562f2334c1b75.png)

大学入試の得点
![大学入試の得点](https://prtimes.jp/i/30937/12/resize/d30937-12-235018-1.jpg){.pb-4}

そこで，p(a,b)を数式を用いて表すことにします．数式で表せばグラフが書けるので，形が同じとか平行移動した関係とかそういうことを語ることができます．ではp(a,b)はどう数式で表せるかですが，その前にp(a,b)が満たすべき条件を3つあげます．

1. \\( p(a,a) = 0 \\)
2. \\( p(a,b) + p(b,c) = p(a,c) \\) 
3. \\( p(-∞,+∞) = 1 \\) 

条件1は，xがピッタリaとなる確率は0だということです．
条件2は
条件3は，

とくに2番目の性質がどう数式で当てはめられるか大きなヒントを与えてくれます．

\\( p(a,b) + p(b,c) = p(a,c) \\)

を満たすには，a,b,cをx軸にとって，ある関数f(x)とx軸が囲む面積とすれば実現できます．

![f(x)とx軸のa,b,cで囲まれた部分](/img/stats/f(x)とx軸で囲まれた部分でp(a,b)を定義.png)

すなわち，

\\[p(a,b) =  \int_{a}^{b} f(x) dx \\]

となるようなf(x)でp(a,b)を求めることにするのです．こうすれば，1番目と2番目の条件は積分の性質から自動的に成立します．

\\[p(a,a) =  \int_{a}^{a} f(x) dx = 0 \\]

3番目の条件は正規化条件と呼ばれますが，f(x)とx軸で囲まれた全面積が1になるという条件になります．

\\[p(-\infty,+\infty) =  \int_{-\infty}^{+\infty} f(x) dx = 1 \\]

身長の分布の場合には，f(x)として正規分布を当てはめれば，これらの条件を良く満たすことが知られています．つまり，適当な正規分布f(x)を選べば，身長xがa≦x≦bとなる確率\\( P(a \leqq x \leqq b ) \\)は，正規分布f(x)とx軸のaからbで囲まれた面積と等しくなるのです．

![ヒストグラムと関数pの対応.pngのグラフと合わせて表示]()

さて，正規分布とは次のような関数です．

\\[f(x) = \frac{1}{\sigma \sqrt{2\pi}}e^{\frac{-(x-\mu)^2}{2\sigma}} \\]

<stbl>見た目の複雑さに怯える必要ありません</stbl>．正規分布について何か計算をすることは，統計の本質を理解することと関係ありません．それよりも

- この関数をどう捉えれば本質が掴めるのか
- なぜ身長の分布に正規分布が当てはめられるのか
- 実際に**適当な**正規分布を当てはめるにはどうすればよいか

これらが次の問題です．

